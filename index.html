<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Calculadora Marketplaces 2026 - Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">
    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-8 text-center sm:text-left flex flex-col sm:flex-row justify-between items-center" data-html2pdf-ignore>
            <div>
                <h1 class="text-3xl font-bold text-indigo-700">Super Calculadora de Marketplaces 2026</h1>
                <p class="text-sm text-gray-500 mt-1">Simule custos, impostos, lucros e preços ideais no e-commerce brasileiro.</p>
            </div>
            <div class="mt-4 sm:mt-0 space-x-2 flex">
                <button @click="resetConservador" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded shadow text-sm font-semibold transition">
                    <i class="fas fa-shield-alt mr-2"></i>Modo Conservador
                </button>
                <button @click="exportarPDF" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow text-sm font-semibold transition">
                    <i class="fas fa-file-pdf mr-2"></i>Exportar PDF
                </button>
            </div>
        </header>

        <div id="conteudo-pdf" class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-4 space-y-6">
                
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2"><i class="fas fa-building mr-2 text-indigo-500"></i>1. Empresa & Tributação</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Regime Tributário</label>
                            <select v-model="empresa.regime" class="w-full mt-1 p-2 border rounded bg-gray-50 text-sm">
                                <option value="simples">Simples Nacional (Sem DIFAL padrão)</option>
                                <option value="presumido">Lucro Presumido/Real</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Alíquota Média Base (%)</label>
                            <input type="number" step="0.1" v-model="empresa.aliquota" class="w-full mt-1 p-2 border rounded text-sm">
                        </div>
                        
                        <div class="pt-3 border-t mt-3">
                            <label class="block text-xs font-semibold text-gray-600 mb-1">Venda Interestadual (Cálculo de DIFAL)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-[10px] text-gray-500">Estado Origem</label>
                                    <select v-model="empresa.estadoOrigem" class="w-full p-1 border rounded text-sm">
                                        <option v-for="uf in ufs" :key="uf" :value="uf">{{ uf }}</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] text-gray-500">Estado Destino</label>
                                    <select v-model="empresa.estadoDestino" class="w-full p-1 border rounded text-sm">
                                        <option v-for="uf in ufs" :key="uf" :value="uf">{{ uf }}</option>
                                    </select>
                                </div>
                            </div>
                            <div v-if="empresa.regime === 'presumido' && empresa.estadoOrigem !== empresa.estadoDestino" class="mt-2 text-xs text-orange-600 font-semibold bg-orange-50 p-2 rounded">
                                <i class="fas fa-exclamation-triangle mr-1"></i> DIFAL Estimado: {{ calcularPercentualDIFAL() }}% aplicados ao lucro.
                            </div>
                        </div>

                        <div class="pt-2">
                            <label class="block text-xs font-semibold text-gray-600">Margem de Lucro Alvo (%)</label>
                            <input type="number" step="1" v-model="empresa.margemAlvo" class="w-full mt-1 p-2 border rounded text-sm bg-indigo-50 font-bold">
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                    <h2 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2"><i class="fas fa-box-open mr-2 text-indigo-500"></i>2. Custos do Produto (CMV)</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Custo (R$)</label>
                            <input type="number" step="0.01" v-model="produto.custo" class="w-full mt-1 p-2 border rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Frete In (R$)</label>
                            <input type="number" step="0.01" v-model="produto.frete" class="w-full mt-1 p-2 border rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Embalagem (R$)</label>
                            <input type="number" step="0.01" v-model="produto.embalagem" class="w-full mt-1 p-2 border rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-600">Devoluções (%)</label>
                            <input type="number" step="0.1" v-model="produto.taxaDevolucao" class="w-full mt-1 p-2 border rounded text-sm" title="Provisão para perdas">
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-gray-50 rounded text-sm font-bold text-gray-700 flex justify-between">
                        <span>CMV Total Unitário:</span>
                        <span>R$ {{ cmvTotal.toFixed(2) }}</span>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 border-l-4 border-l-indigo-500">
                    <h2 class="text-lg font-bold text-gray-700 mb-2">Preço de Venda (Simulação)</h2>
                    <input type="number" step="1" v-model="produto.precoVenda" class="w-full p-3 border-2 border-indigo-200 rounded-lg text-lg font-bold text-indigo-700 text-center">
                </div>
            </div>

            <div class="lg:col-span-8">
                <h2 class="text-xl font-bold text-gray-800 mb-4"><i class="fas fa-chart-line mr-2 text-indigo-500"></i>3. Comparativo de Marketplaces</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div v-for="(mkp, index) in marketplaces" :key="index" class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 flex flex-col">
                        
                        <div class="flex justify-between items-center border-b pb-3 mb-3">
                            <h3 class="text-lg font-bold" :class="mkp.color">{{ mkp.nome }}</h3>
                            <button @click="mkp.showEdit = !mkp.showEdit" class="text-xs text-gray-500 hover:text-gray-800" data-html2pdf-ignore>
                                <i class="fas fa-cog"></i> Editar
                            </button>
                        </div>

                        <div v-show="mkp.showEdit" class="bg-gray-50 p-3 rounded mb-4 text-sm grid grid-cols-2 gap-2 border" data-html2pdf-ignore>
                            <div><label class="block text-xs">Comissão (%)</label><input type="number" step="0.1" v-model="mkp.comissao" class="w-full p-1 border rounded"></div>
                            <div><label class="block text-xs">Taxa Fixa (R$)</label><input type="number" step="0.1" v-model="mkp.taxaFixa" class="w-full p-1 border rounded"></div>
                            <div><label class="block text-xs">Fulfillment (R$)</label><input type="number" step="0.1" v-model="mkp.custoFreteMkp" class="w-full p-1 border rounded"></div>
                            <div><label class="block text-xs">Ads (%)</label><input type="number" step="0.1" v-model="mkp.ads" class="w-full p-1 border rounded"></div>
                        </div>

                        <div class="flex-grow space-y-2 text-sm">
                            <div class="flex justify-between text-gray-600">
                                <span>Receita Bruta</span><span>R$ {{ produto.precoVenda.toFixed(2) }}</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>- Custos (CMV + Provisão)</span><span>R$ {{ calcularCustoTotal().toFixed(2) }}</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>- Taxas Plataforma</span><span>R$ {{ calcularTaxas(mkp).toFixed(2) }}</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>- Tributação Base</span><span>R$ {{ calcularImpostoBase().toFixed(2) }}</span>
                            </div>
                            <div v-if="empresa.regime === 'presumido' && calcularPercentualDIFAL() > 0" class="flex justify-between text-orange-500">
                                <span>- DIFAL Estimado</span><span>R$ {{ calcularValorDIFAL().toFixed(2) }}</span>
                            </div>
                            <hr class="my-2">
                            
                            <div class="flex justify-between items-center pt-1">
                                <span class="font-bold text-gray-700">Lucro Líquido</span>
                                <span class="text-lg font-bold" :class="calcularLucro(mkp) >= 0 ? 'text-green-600' : 'text-red-600'">
                                    R$ {{ calcularLucro(mkp).toFixed(2) }}
                                </span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-gray-700">Margem Líquida</span>
                                <span class="font-bold" :class="calcularMargem(mkp) >= empresa.margemAlvo ? 'text-green-600' : (calcularMargem(mkp) > 0 ? 'text-yellow-500' : 'text-red-600')">
                                    {{ calcularMargem(mkp).toFixed(1) }}%
                                </span>
                            </div>
                        </div>

                        <div class="mt-4 p-3 bg-indigo-50 rounded-lg border border-indigo-100 text-center">
                            <span class="block text-xs text-indigo-600 font-semibold mb-1">Preço Sugerido (Alvo: {{empresa.margemAlvo}}%)</span>
                            <span class="text-xl font-bold text-indigo-800">R$ {{ calcularPrecoIdeal(mkp).toFixed(2) }}</span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    ufs: ['AC','AL','AM','AP','BA','CE','DF','ES','GO','MA','MG','MS','MT','PA','PB','PE','PI','PR','RJ','RN','RO','RR','RS','SC','SE','SP','TO'],
                    // Alíquotas internas aproximadas para 2026 (muitos estados subiram para 19% ou mais)
                    aliquotasInternas: {
                        'AC': 19, 'AL': 19, 'AM': 20, 'AP': 18, 'BA': 19, 'CE': 20, 'DF': 18, 'ES': 17, 
                        'GO': 19, 'MA': 22, 'MG': 18, 'MS': 17, 'MT': 17, 'PA': 19, 'PB': 18, 'PE': 20.5, 
                        'PI': 21, 'PR': 19, 'RJ': 20, 'RN': 20, 'RO': 19.5, 'RR': 20, 'RS': 17, 'SC': 17, 
                        'SE': 22, 'SP': 18, 'TO': 20
                    },
                    empresa: {
                        regime: 'simples',
                        aliquota: 6.0,
                        margemAlvo: 10.0,
                        estadoOrigem: 'SP',
                        estadoDestino: 'SP'
                    },
                    produto: {
                        custo: 35.00,
                        frete: 2.00,
                        embalagem: 1.50,
                        taxaDevolucao: 1.0, // 1% de provisão para devoluções
                        precoVenda: 89.90
                    },
                    marketplaces: []
                }
            },
            computed: {
                cmvTotal() {
                    return this.produto.custo + this.produto.frete + this.produto.embalagem;
                }
            },
            methods: {
                carregarMarketplacesConservador() {
                    this.marketplaces = [
                        { nome: 'Shopee (Acelera + SFP)', color: 'text-orange-500', comissao: 22.5, taxaFixa: 7.00, custoFreteMkp: 0, ads: 2, showEdit: false },
                        { nome: 'Mercado Livre (Premium)', color: 'text-yellow-500', comissao: 19, taxaFixa: 6.00, custoFreteMkp: 0, ads: 0, showEdit: false },
                        { nome: 'TikTok Shop', color: 'text-black', comissao: 6, taxaFixa: 4.00, custoFreteMkp: 0, ads: 5, showEdit: false },
                        { nome: 'Amazon (FBA)', color: 'text-blue-600', comissao: 15, taxaFixa: 0.00, custoFreteMkp: 14.50, ads: 0, showEdit: false },
                        { nome: 'Shein (Nova Regra)', color: 'text-gray-800', comissao: 20, taxaFixa: 0.00, custoFreteMkp: 5.00, ads: 0, showEdit: false },
                        { nome: 'Magalu', color: 'text-blue-400', comissao: 20, taxaFixa: 5.00, custoFreteMkp: 0, ads: 0, showEdit: false }
                    ];
                },
                resetConservador() {
                    this.produto.precoVenda = 89.90;
                    this.carregarMarketplacesConservador();
                },
                // LÓGICA DO DIFAL
                calcularPercentualDIFAL() {
                    if (this.empresa.regime === 'simples' || this.empresa.estadoOrigem === this.empresa.estadoDestino) {
                        return 0; // Simples não recolhe DIFAL na venda para consumidor final na regra geral
                    }
                    
                    const origem = this.empresa.estadoOrigem;
                    const destino = this.empresa.estadoDestino;
                    const sulSudeste = ['PR', 'RS', 'SC', 'SP', 'RJ', 'MG']; // ES é exceção
                    const norteNordesteCentroOesteES = ['AC','AL','AM','AP','BA','CE','DF','GO','MA','MS','MT','PA','PB','PE','PI','RN','RO','RR','SE','TO','ES'];
                    
                    let aliquotaInterestadual = 12;
                    // Se a origem é Sul/Sudeste e o destino é N/NE/CO ou ES, a alíquota interestadual é 7%
                    if (sulSudeste.includes(origem) && norteNordesteCentroOesteES.includes(destino)) {
                        aliquotaInterestadual = 7;
                    }

                    const aliquotaInternaDestino = this.aliquotasInternas[destino];
                    let difal = aliquotaInternaDestino - aliquotaInterestadual;
                    
                    return difal > 0 ? difal : 0;
                },
                calcularValorDIFAL() {
                    return this.produto.precoVenda * (this.calcularPercentualDIFAL() / 100);
                },
                calcularCustoTotal() {
                    const provisaoDevolucao = this.produto.precoVenda * (this.produto.taxaDevolucao / 100);
                    return this.cmvTotal + provisaoDevolucao;
                },
                calcularTaxas(mkp) {
                    const comissaoValor = this.produto.precoVenda * (mkp.comissao / 100);
                    const adsValor = this.produto.precoVenda * (mkp.ads / 100);
                    return comissaoValor + mkp.taxaFixa + mkp.custoFreteMkp + adsValor;
                },
                calcularImpostoBase() {
                    return this.produto.precoVenda * (this.empresa.aliquota / 100);
                },
                calcularLucro(mkp) {
                    return this.produto.precoVenda - this.calcularCustoTotal() - this.calcularTaxas(mkp) - this.calcularImpostoBase() - this.calcularValorDIFAL();
                },
                calcularMargem(mkp) {
                    const lucro = this.calcularLucro(mkp);
                    if(this.produto.precoVenda <= 0) return 0;
                    return (lucro / this.produto.precoVenda) * 100;
                },
                calcularPrecoIdeal(mkp) {
                    const percentualTotal = (mkp.comissao + mkp.ads + this.empresa.aliquota + this.calcularPercentualDIFAL() + this.produto.taxaDevolucao + this.empresa.margemAlvo) / 100;
                    const custosFixosUnitarios = this.cmvTotal + mkp.taxaFixa + mkp.custoFreteMkp;
                    
                    if (percentualTotal >= 1) return 0; 
                    return custosFixosUnitarios / (1 - percentualTotal);
                },
                exportarPDF() {
                    const element = document.getElementById('conteudo-pdf');
                    const opt = {
                        margin:       0.5,
                        filename:     'Simulacao_Marketplaces_2026.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2 },
                        jsPDF:        { unit: 'in', format: 'letter', orientation: 'landscape' }
                    };
                    html2pdf().set(opt).from(element).save();
                }
            },
            mounted() {
                this.carregarMarketplacesConservador();
            }
        }).mount('#app')
    </script>
</body>
</html>
